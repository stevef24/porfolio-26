---
title: Building a Deep Research Agent with the Claude Agent SDK
description: A step-by-step guide to building an autonomous research agent that searches, analyzes, and synthesizes information using the Claude Agent SDK.
author: Stav Fernandes
date: 2026-01-10
---

When I first started building AI agents, I spent more time wiring up tool execution loops than actually solving problems. The Claude Agent SDK changed that. It handles the orchestration so you can focus on what your agent should do, not how to make it run.

Deep research is one of the most compelling use cases for AI agents. A single search rarely tells the full story - you need multiple sources, cross-referencing, and synthesis. Doing this manually is tedious. Doing it with a well-designed agent takes seconds and produces better results than most humans could in hours.

In this post, we'll build a Deep Research Agent from scratch. Not a toy example - a production-ready system that searches multiple sources, extracts key findings, verifies facts across references, and synthesizes everything into a structured report with confidence levels and citations.

The SDK gives us three things that would take weeks to build ourselves: a streaming message protocol for real-time progress, MCP integration for extensible tools, and a subagent system for parallel specialized work. We'll use all three.

## What We're Building

Our research agent will:

1. Accept a research topic and break it down into search queries
2. Search multiple sources in parallel using subagents
3. Extract and analyze content from each source
4. Cross-reference findings for accuracy
5. Produce a structured research report with citations

Think of it as having a small research team: one agent coordinates, others specialize in finding sources, analyzing content, and fact-checking. The SDK makes this orchestration surprisingly simple.

## Prerequisites

Before we start, you'll need:

- Node.js 18+ installed
- An Anthropic API key ([get one here](https://console.anthropic.com))
- Claude Code CLI installed and authenticated

```bash
npm install -g @anthropic-ai/claude-code
claude  # Follow prompts to authenticate
```

## Building the Agent

import { deepResearchSteps } from "./agent-sdk-deep-research.steps";

<Scrolly steps={deepResearchSteps} />

## The Architecture in Action

When you run this agent, here's what happens under the hood. Scroll through to see each phase of the pipeline:

<AgentArchitectureDemo />

## V2 Preview: What's Changing

The V2 SDK is currently unstable but worth understanding. The patterns you've learned transfer directly - V2 just makes some things more explicit.

<Callout type="info" title="One-Shot Prompts (Step 1)">
V2 introduces `unstable_v2_prompt()` for simple, single-turn interactions:

```ts
import { unstable_v2_prompt } from "@anthropic-ai/claude-agent-sdk"

const result = await unstable_v2_prompt("What is 2+2?", {
  model: "sonnet"
})
```

This replaces the `query()` pattern when you don't need streaming or multi-turn conversations.
</Callout>

<Callout type="info" title="Session Configuration (Step 2)">
Configuration moves to explicit session creation:

```ts
import { unstable_v2_createSession } from "@anthropic-ai/claude-agent-sdk"

const session = unstable_v2_createSession({
  model: "opus",
  allowedTools: ["WebSearch", "Read"],
  systemPrompt: "You are a research specialist."
})
```

Sessions can be resumed with `unstable_v2_resumeSession(sessionId)`.
</Callout>

<Callout type="info" title="Streaming Separation (Step 7)">
V2 separates sending messages from receiving responses:

```ts
// Send the message
await session.send("Research AI agent architectures")

// Stream the response separately
for await (const message of session.stream()) {
  console.log(message.type, message)
}

// Clean up with automatic disposal
await using session = unstable_v2_createSession(options)
```

The `await using` syntax (TypeScript 5.2+) handles cleanup automatically.
</Callout>

The migration path is straightforward: replace `query()` with session-based calls, and your tool definitions and subagent patterns work unchanged.

## What's Next

From here, you could extend the agent with:

- **Domain-specific tools** - Add MCP servers for databases, APIs, or internal docs
- **Citation verification** - Use web fetch to validate source URLs
- **Cost controls** - Add budget limits and model fallbacks
- **Caching** - Store research results to avoid redundant searches

The beauty of the SDK is that these additions are incremental. You're not fighting framework constraints - you're composing capabilities.

## Resources

- [Claude Agent SDK Reference](https://docs.anthropic.com/en/docs/claude-agent-sdk)
- [MCP Server Directory](https://github.com/modelcontextprotocol/servers)
- [Claude Code Documentation](https://docs.anthropic.com/en/docs/claude-code)

The full source code for this agent is available in the companion repository. Clone it, modify it, break it, and build something that solves your specific research needs.
